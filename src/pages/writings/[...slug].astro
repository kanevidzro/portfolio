---
import { type CollectionEntry, getCollection } from 'astro:content'
import Layout from '../../layouts/Layout.astro'
import FormattedDate from '../../components/FormattedDate.astro'
import { readingTime } from '../../lib/utils'
import clsx from 'clsx'

export async function getStaticPaths() {
  const writings = (await getCollection('writing'))
    .filter((post) => !post.data.draft)
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  return writings.map((post) => ({
    params: { slug: post.slug },
    props: post,
  }))
}
type Props = CollectionEntry<'writing'>

const post = Astro.props
const { Content } = await post.render()

const { title, description, pubDate, heroImage } = post.data

const ogImageUrl = new URL(`/og/${post.slug}.png`, Astro.site).toString()
---

<Layout title={title} description={description} image={ogImageUrl}>
  <script
    is:inline
    type="application/ld+json"
    set:html={JSON.stringify({
      '@context': 'https://schema.org',
      '@type': 'BlogPosting',
      headline: title,
      description: description,
      image: ogImageUrl,
      url: new URL(Astro.url.pathname, Astro.site).toString(),
      datePublished: pubDate,
      dateModified: pubDate,
      author: {
        '@type': 'Person',
        name: 'Kane Vidzro',
        url: 'https://kanevidzro.com',
      },
      mainEntityOfPage: {
        '@type': 'WebPage',
        '@id': new URL(Astro.url.pathname, Astro.site).toString(),
      },
    })}
  />

  <section>
    <article
      id="blog-content"
      class="flex w-full flex-col items-center justify-center gap-6">
      <h1
        class="w-full text-4xl font-medium tracking-tight md:text-5xl lg:text-7xl">
        {title}
      </h1>
      <div class="flex w-full flex-row gap-2">
        <p class="text-start font-medium text-gray-500">
          <FormattedDate date={pubDate} />
        </p>
        <span class="font-medium text-gray-500">Â·</span>
        <p class="text-start font-medium text-gray-500">
          {readingTime(post.body)}
        </p>
      </div>
      <p
        class="w-full text-start text-lg font-medium text-gray-700 dark:text-gray-300">
        <span class="font-semibold text-gray-900 dark:text-white">tl;dr:</span>
        {description}
      </p>

      {
        heroImage && (
          <img src={heroImage} alt={title} class="w-full rounded-lg" />
        )
      }

      <div
        class={clsx(
          'w-full prose prose-lg my-3 prose-p:font-medium dark:prose-invert prose-a:underline prose-a:bg-orange-50 prose-a:decoration-orange-500 items-center justify-center',
          'dark:prose-a:bg-orange-950 dark:prose-a:decoration-orange-400 dark:prose-a:underline',
          'prose-h1:font-medium prose-h2:font-medium prose-h3:font-medium prose-h4:font-medium prose-h5:font-medium prose-h6:font-medium',
          'prose-h1:tracking-tight prose-h2:tracking-tight prose-h3:tracking-tight prose-h4:tracking-tight prose-h5:tracking-tight prose-h6:tracking-tight',
          'prose-ul:font-medium prose-ol:font-medium prose-li:font-medium',
          'prose-ul:space-y-3 prose-ol:space-y-3 prose-li:space-y-3',
        )}>
        <Content />
      </div>
    </article>
  </section>
</Layout>
